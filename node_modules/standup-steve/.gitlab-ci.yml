pages:
  image: python:alpine
  before_script:
  - apk update && apk add bash curl ruby ruby-irb ruby-rdoc
  - gem install coderay kramdown
  script:
  # Create webpage from the README
  - mkdir -p public
  - curl http://cdn.tjaart.org/gitlab/index.html.erb --output index.html.erb
  - sed -i "s@#CI_PROJECT_URL#@${CI_PROJECT_URL}@" index.html.erb
  - kramdown --template index.html.erb README.md > public/index.html
  - cp -r assets public/
  # Create documentation, using mkdocs
  - pip install mkdocs
  - mkdocs build -d public/docs/
  artifacts:
    paths:
    - public
  only:
  - master
  except:
  - tags

publish:
  image: node
  script:
  - echo "//registry.npmjs.org/:_authToken=${NPM_AUTH_TOKEN}" > .npmrc
  - npm publish
  only:
  - tags
